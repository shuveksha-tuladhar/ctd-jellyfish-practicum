<div>
  <%= render "shared/navbar" %>

  <!-- Main layout -->
  <div class="main-container">

    <!-- Sidebar -->
    <%= render "shared/sidebar" %>

    <!-- Dashboard -->
    <div class="dashboard-container">

      <!-- Top row with 3 cards -->
      <div class="first-row">
        <div>
          <h2>Welcome, <%= current_user.first_name %> <%= current_user.last_name %>!</h2>
        </div>

        <div class="cards-container">
          <!-- Total Balance -->
          <div class="card">
            <div class="title-row">
              <h3>Total Balance</h3>
              <span><i class="bi bi-currency-dollar"></i></span>
            </div>
            <p>
              $<%= number_with_precision(@balance_summary[:net_balance], precision: 2) %>
              <% if @balance_summary[:net_balance] >= 0 %>
                <span class="green-text">You are owed</span>
              <% else %>
                <span class="red-text">You owe</span>
              <% end %>
            </p>
            <%= link_to "View Details", user_balances_path(@user), class:"btn" %>
          </div>

          <!-- Group Expenses -->
          <div class="card">
            <div class="title-row">
              <h3>Group Expenses</h3>
              <span><i class="bi bi-people"></i></span>
            </div>
            <p>
              <%= @groups.count %>
              <span class="gray-text">Active groups</span>
            </p>
            <%= link_to "Manage groups", user_groups_path, class:"btn" %>
          </div>

          <!-- Monthly Spending -->
          <div class="card">
            <div class="title-row">
              <h3>Monthly Spending</h3>
              <span><i class="bi bi-bar-chart-line"></i></span>
            </div>
            <p>$<%= sprintf('%.2f', @monthly_spending) %></p>
            <%= link_to "View expenses", expenses_path, class:"btn" %>
          </div>
        </div>
      </div>

      <!-- Second row -->
      <div>
        <!-- Left: Recent Activity -->
        <div class="card">
          <div class="title-row">
            <h3>Recent Activity</h3>
            <%= link_to "View all", expenses_path, class: "btn" %>
          </div>
          <ul class="activity-list">
            <% @recent_activities.each do |activity| %>
              <li class="activity-item">
                <div class="activity-description">
                  <% if activity[:type] == "expense" %>
                    <strong><%= activity[:with] %></strong>
                    <% if activity[:owes_you] %>
                      owes you
                    <% else %>
                      you owe
                    <% end %>
                    <strong><%= number_to_currency(activity[:amount]) %></strong>
                    for <%= activity[:name] %>

                  <% elsif activity[:type] == "group" %>
                    Created new group: <strong><%= activity[:name] %></strong>

                  <% elsif activity[:type] == "friend" %>
                    Added new friend: <strong><%= activity[:name] %></strong>
                  <% end %>
                </div>
                <span class="activity-time"><%= time_ago_in_words(activity[:created_at]) %> ago</span>
              </li>
            <% end %>
          </ul>
        </div>


        <!-- Right side cards -->
        <div class="right-cards">
          <!-- Quick Actions -->
          <div class="card">
            <h3>Quick Actions</h3>
            <div class="quick-actions-wrapper">
              <div class="quick-actions-card">
                <%= link_to "View expenses", expenses_path %>
              </div>
              <div class="quick-actions-card">
                <%= link_to "Manage groups", user_groups_path %>
              </div>
              <div class="quick-actions-card">
                <%= link_to "Settle Up", user_payments_path(@user.id) %>
              </div>
            </div>
          </div>

          <!-- Friend Balances -->
          
          <div class="card">
            <div class="title-row">
              <h3>Friend Balances</h3>
              <%= link_to "View all", user_balances_path(@user), class: "btn" %>
            </div>
            <ul>
             <% @balance_summary[:balances].each do |friend, balance| %>
                <% next if friend == current_user %> <!-- safer check -->
                <li>
                  <%= friend.full_name %>: 
                  <% if balance > 0 %>
                    <span class="green-text">owes you $<%= number_with_precision(balance, precision: 2) %></span>
                  <% elsif balance < 0 %>
                    <span class="red-text">you owe $<%= number_with_precision(balance.abs, precision: 2) %> to</span>
                    <%= friend.full_name %>
                  <% else %>
                    <span class="gray-text">settled up</span>
                  <% end %>
                </li>
              <% end %>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
/* Reset and Base Styles */
  body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: Arial, sans-serif;
      background-color: #f3f3f3;
  }
  /* Main container and layout */
  .main-container {
    display: flex;
    gap: 20px;
    padding: 20px;
    padding-top: 100px; 
    box-sizing: border-box;
    background-color: #f0f0f0; 
    min-height: 100vh; 
}

.sidebar ul li {
  border-bottom: none;
  padding: 10px 0; 
}


  /* Dashboard container */
  .dashboard-container {
    flex: 2;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .first-row {
    display: flex;
    flex-direction: column;
  }
  .cards-container {
    display: flex;
    justify-content: space-between;
    gap: 20px;
  }

  /* General card style */
  .card {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-sizing: border-box;
    box-shadow: 0 1px 3px rgb(0 0 0 / 0.1);
    display: flex;
    flex-direction: column;
    flex: 1;
    min-width: 200px;
  }

  /* Top row with 3 cards */
  .dashboard-container > div:first-child {
    display: flex;
    gap: 20px;
    justify-content: space-between;
  }

  .dashboard-container > div:first-child > .card {
    flex: 1;
  }

  /* Top row cards buttons */
  .dashboard-container > div:first-child > .card > button, .btn {
    width: auto;         
    align-self: flex-start; 
    padding: 8px 16px;
    margin-top: 15px;
    background-color: #1d917a;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    display: inline-block; 
  }
  .btn {
    text-decoration: none;
  }

  .dashboard-container > div:first-child > .card > button:hover {
    background-color: #0ca694;
  }

  /* Title row */
  .title-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  /* Text colors */
  .green-text {
    color: green;
    font-size: 13px;
    margin-left: 6px;
  }

  .title-row i {
    font-size: 1.2em;
    color: #1d917a; 
    vertical-align: middle;
    margin-left: 5px;
  }

  .red-text {
    color: red;
    font-size: 13px;
    margin-left: 6px;
  }

  .gray-text {
    color: #666;
    font-size: 13px;
    margin-left: 6px;
  }

  /* Second row with two sections */
  .dashboard-container > div:last-child {
    display: flex;
    gap: 20px;
  }

  /* Left card (Recent Activity) */
  .dashboard-container > div:last-child > div:first-child {
    flex: 1;
  }

  /* Right side cards container */
  .right-cards {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .activity-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.activity-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px solid #e0e0e0;
  font-size: 14px;
}

.activity-description {
  font-size: 14px;
}

.activity-time {
  font-size: 12px;
  color: #888;
}

  /* Quick actions wrapper */
  .quick-actions-wrapper {
    display: flex;
    gap: 15px;
    margin-top: 10px;
    align-items: stretch;
  }

  /* Each quick action card */
  .quick-actions-card {
    flex: 1;
    background-color: #f8f8f8;
    border-radius: 8px;
    padding: 14px 20px;
    text-align: center;
    box-sizing: border-box;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: auto;
    height: auto;
    flex-direction: column;
  }

  /* Button inside quick action cards */
  .quick-actions-card button {
    background-color: rgba(29, 145, 122, 0.7);
    color: white;
    border: none;
    padding: 14px 10px;
    border-radius: 4px;
    cursor: pointer;
    width: 100%;
  }

  .quick-actions-card button:hover {
    background-color: #0ca694;
  }

  .quick-actions-card a {
    background-color: rgba(29, 145, 122, 0.7);
    color: white;
    border: none;
    padding: 20px 10px;
    border-radius: 4px;
    cursor: pointer;
    width: 100%;
    text-decoration: none;
    display: inline-block;
    font-size: 14px;
  }

  .quick-actions-card a:hover {
    background-color: #0ca694;
  }

  /* List styling */
  ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  ul li {
    padding: 8px 0;
    border-bottom: 1px solid #e0e0e0;
    font-size: 14px;
  }

  /* Logout button */
    .logout-btn {
      background: white;
      color: #1d917a;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
    }

    .logout-btn:hover {
      background-color: #0ca694;
      color: white;
    }


  /* Responsive layout */
  @media (max-width: 768px) {
    .sidebar {
        position: static;  
        height: auto;     
        width: 100%;       
        overflow-y: visible; 
    }

    .main-container {
        flex-direction: column; 
        padding-left: 0; 
    }

    .dashboard-container {
        width: 100%; 
    }
    .dashboard-container > div:first-child,
    .dashboard-container > div:last-child {
      flex-direction: column;
    }

    .dashboard-container > div:first-child > .card,
    .dashboard-container > div:last-child > div {
      width: 100%;
    }
    .cards-container {
      flex-direction: column;
    }
    .card {
      width: 100%;
      min-width: unset;
    }
  }
</style>
